machine:
  services:
    - neo4j
  node:
    version: 6.1.0
general:
  build_dir: src/server
dependencies:
  override:
    - sudo apt-get update
    - sudo apt-get install npm
    - npm install
  post:
    - npm -v
    - npm config set strict-ssl false #temp fix for SSL issue: https://stackoverflow.com/questions/44577368/codeship-basic-npm-install-fails-error-ssl-error-cert-untrusted
    - sudo npm install -g pm2@latest
    - ../../deployment/scripts/setup_dirs.sh
    - ../../deployment/scripts/setup_env.sh
    - node ./index.js:
        background: true
    - sleep 5
deployment:
  production:
    branch: master
    commands:
      - ../../deployment/scripts/deploy_stage.sh

